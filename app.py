import streamlit as st
import pandas as pd

# Configuraci√≥n b√°sica de la aplicaci√≥n
st.set_page_config(page_title="Generador de Certificados", layout="centered")

st.title("üéì Generador de Certificados")

st.write("Bienvenido al generador de certificados. Ingrese la informaci√≥n requerida para generar su diploma.")

# URL p√∫blica de Google Sheets en formato CSV
url = "https://docs.google.com/spreadsheets/d/1XSzJ_cZWr7co6c_86CCzfWNgEKwxB8Wn5NBt4PpNAUc/gviz/tq?tqx=out:csv"

# Cargar la hoja de c√°lculo como un DataFrame
@st.cache_data
def load_data():
    return pd.read_csv(url)

df_cursos = load_data()

# Mostrar los primeros registros para verificar
st.subheader("Lista de cursos disponibles")
st.dataframe(df_cursos[["C√≥digo", "Nombre del Curso o Diplomado", "Cohorte", "Fecha", "Duraci√≥n", "Docente", "validaci√≥n"]])

# Seleccionar el curso desde un selectbox
curso_seleccionado = st.selectbox("üìö Seleccione un curso o diplomado", df_cursos["Nombre del Curso o Diplomado"].unique())

# Obtener el c√≥digo del curso seleccionado
codigo_curso = df_cursos[df_cursos["Nombre del Curso o Diplomado"] == curso_seleccionado]["C√≥digo"].values[0]

st.write(f"Has seleccionado el curso: **{curso_seleccionado}**")
st.write(f"C√≥digo del curso: `{codigo_curso}`")

# URL p√∫blica de la hoja de c√°lculo de estudiantes en formato CSV
url_estudiantes = "https://docs.google.com/spreadsheets/d/1prUt0i0EWolsX_LuGl_yKzXPUWmy6CzCxi28zued5BA/gviz/tq?tqx=out:csv"

# Cargar los datos de los estudiantes
@st.cache_data
def load_students():
    return pd.read_csv(url_estudiantes)

df_estudiantes = load_students()

# Campo de entrada para la contrase√±a del estudiante
password_input = st.text_input("üîë Ingrese su contrase√±a", type="password")

# Filtrar la hoja de estudiantes por el c√≥digo del curso seleccionado
df_curso_estudiantes = df_estudiantes[df_estudiantes["C√≥digo"] == codigo_curso]

# Bot√≥n para validar
if st.button("Validar contrase√±a"):
    if password_input:
        # Buscar si la contrase√±a ingresada coincide con alguna en la hoja de c√°lculo
        estudiante = df_curso_estudiantes[df_curso_estudiantes["Contrase√±a"] == password_input]

        if not estudiante.empty:
            nombre_estudiante = estudiante["Nombre"].values[0]
            documento_estudiante = estudiante["Documento"].values[0]

            st.success(f"‚úÖ Acceso concedido: {nombre_estudiante}")
            st.write(f"üìÑ Documento: `{documento_estudiante}`")
        else:
            st.error("‚ùå Contrase√±a incorrecta o estudiante no registrado en este curso.")
    else:
        st.warning("‚ö†Ô∏è Por favor, ingrese su contrase√±a.")
